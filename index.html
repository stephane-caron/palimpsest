<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>palimpsest: palimpsest ‚Äî Fast serializable C++ dictionaries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">palimpsest<span id="projectnumber">&#160;v3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">palimpsest ‚Äî Fast serializable C++ dictionaries </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> <a href="https://github.com/stephane-caron/palimpsest/actions"><img src="https://img.shields.io/github/actions/workflow/status/stephane-caron/palimpsest/bazel.yml?branch=main" alt="CI" class="inline"/></a> <a href="https://stephane-caron.github.io/palimpsest/"><img src="https://img.shields.io/badge/docs-online-brightgreen?style=flat" alt="Documentation" class="inline"/></a> <a href="https://coveralls.io/github/stephane-caron/palimpsest?branch=main"><img src="https://coveralls.io/repos/github/stephane-caron/palimpsest/badge.svg?branch=main" alt="Coverage" style="pointer-events: none;" class="inline"/></a> <img src="https://img.shields.io/badge/C++-17/20-blue.svg?style=flat" alt="C++ version" style="pointer-events: none;" class="inline"/> <a href="https://github.com/stephane-caron/palimpsest/releases"><img src="https://img.shields.io/github/v/release/stephane-caron/palimpsest.svg?sort=semver" alt="Release" style="pointer-events: none;" class="inline"/></a></p>
<p >The palimpsest library implements a <code>Dictionary</code> type for C++ meant for fast value updates and serialization. It is called <a href="https://en.wiktionary.org/wiki/palimpsest#Noun">palimpsest</a> because dictionaries are designed for frequent rewritings (values change fast) on the same support (keys change slow).</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Example</h1>
<p >Let's fill a dictionary and print it to the standard output:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Dictionary_8h.html">palimpsest/Dictionary.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span><a class="code hl_class" href="classpalimpsest_1_1Dictionary.html">palimpsest::Dictionary</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">  Dictionary world;</div>
<div class="line">  world(<span class="stringliteral">&quot;name&quot;</span>) = <span class="stringliteral">&quot;example&quot;</span>;</div>
<div class="line">  world(<span class="stringliteral">&quot;temperature&quot;</span>) = 28.0;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span>&amp; bodies = world(<span class="stringliteral">&quot;bodies&quot;</span>);</div>
<div class="line">  bodies(<span class="stringliteral">&quot;plane&quot;</span>)(<span class="stringliteral">&quot;orientation&quot;</span>) = Eigen::Quaterniond{0.9239, 0.3827, 0., 0.};</div>
<div class="line">  bodies(<span class="stringliteral">&quot;plane&quot;</span>)(<span class="stringliteral">&quot;position&quot;</span>) = Eigen::Vector3d{0.0, 0.0, 100.0};</div>
<div class="line">  bodies(<span class="stringliteral">&quot;truck&quot;</span>)(<span class="stringliteral">&quot;orientation&quot;</span>) = Eigen::Quaterniond::Identity();</div>
<div class="line">  bodies(<span class="stringliteral">&quot;truck&quot;</span>)(<span class="stringliteral">&quot;position&quot;</span>) = Eigen::Vector3d{42.0, 0.0, 0.0};</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; world &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="aDictionary_8h_html"><div class="ttname"><a href="Dictionary_8h.html">Dictionary.h</a></div></div>
<div class="ttc" id="aclasspalimpsest_1_1Dictionary_html"><div class="ttname"><a href="classpalimpsest_1_1Dictionary.html">palimpsest::Dictionary</a></div><div class="ttdoc">Dictionary of values and sub-dictionaries.</div><div class="ttdef"><b>Definition:</b> <a href="Dictionary_8h_source.html#l00096">Dictionary.h:96</a></div></div>
</div><!-- fragment --><p >This code outputs:</p>
<div class="fragment"><div class="line">{&quot;bodies&quot;: {&quot;truck&quot;: {&quot;position&quot;: [42, 0.5, 0], &quot;orientation&quot;: [1, 0, 0, 0]},</div>
<div class="line">&quot;plane&quot;: {&quot;position&quot;: [0.1, 0, 100], &quot;orientation&quot;: [0.9239, 0.3827, 0, 0]}},</div>
<div class="line">&quot;temperature&quot;: 28, &quot;name&quot;: &quot;example&quot;}</div>
</div><!-- fragment --><p >We can serialize the dictionary to file:</p>
<div class="fragment"><div class="line">world.write(<span class="stringliteral">&quot;world.mpack&quot;</span>);</div>
</div><!-- fragment --><p >And deserialize it likewise:</p>
<div class="fragment"><div class="line">Dictionary world_bis;</div>
<div class="line">world_bis.read(<span class="stringliteral">&quot;world.mpack&quot;</span>);</div>
<div class="line">std::cout &lt;&lt; world_bis &lt;&lt; std::endl;</div>
</div><!-- fragment --><p >Dictionaries can also be serialized to bytes for transmission over TCP, memory-mapped files, telegraph lines, etc. Check out the <a href="https://github.com/stephane-caron/palimpsest/tree/main/examples">examples</a> directory for more advanced use cases.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Comparison to Python dictionaries</h1>
<p >Palimpsest will feel familiar if you are used to Python dictionaries, as its API is a subset of Python's <code>dict</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">üêç Python <code>dict</code>   </th><th class="markdownTableHeadNone">üöÄ Palimpsest <code>Dictionary</code>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.clear"><code>dict.clear</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#ae98a88dd6a1c5e5afa84f719189882d9"><code>Dictionary::clear</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.copy"><code>dict.copy</code></a>   </td><td class="markdownTableBodyNone">Dictionaries are <a href="https://github.com/stephane-caron/palimpsest?tab=readme-ov-file#non-features">move-only</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/copy.html#copy.deepcopy"><code>copy.deepcopy</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#a2ddbd4316657e27d11c5a07a476841e6"><code>Dictionary::deepcopy</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.fromkeys"><code>dict.fromkeys</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#afdd77ff6fefa0d086cd9a32c1f75cb96"><code>Dictionary::fromkeys</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.get"><code>dict.get</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#a74bd56b0ec9e4219f54430bcb6f9a084"><code>Dictionary::get</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.items"><code>dict.items</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#ac38517fbe0ac91132d98216224577f48"><code>Dictionary::items</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.keys"><code>dict.keys</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#abb1589b67dbeadec8774833921644798"><code>Dictionary::keys</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.pop"><code>dict.pop</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#a26a5e2623e96221ddae92677f41a69a1"><code>Dictionary::pop</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.popitem"><code>dict.popitem</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#a1f131706b9fe3e3ccaaeae405c81f27c"><code>Dictionary::popitem</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.setdefault"><code>dict.setdefault</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#aaa4a895aa93a7483ea49d3231f5e0b6b"><code>Dictionary::setdefault</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.update"><code>dict.update</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#a1b5bb02bcf813b05aef280f47b25ce80"><code>Dictionary::update</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://docs.python.org/3/library/stdtypes.html#dict.values"><code>dict.values</code></a>   </td><td class="markdownTableBodyNone"><a href="https://stephane-caron.github.io/palimpsest/classpalimpsest_1_1Dictionary.html#af71082c3d7f7c6624fb76fde3eb88ad3"><code>Dictionary::values</code></a>   </td></tr>
</table>
<p >There are a few differences:</p>
<ul>
<li>Dictionaries are move-only: there is no <code>copy</code> function matching Python's <code>dict.copy</code>, but <code>Dictionary::deepcopy</code> matches Python's <code>copy.deepcopy</code>.</li>
<li>Dictionaries do not conserve insertion order, whereas insertion order conservation is guaranteed in Python since version 3.7 of the language.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Features and non-features</h1>
<p >The two main assumptions in palimpsest dictionaries are that:</p>
<ul>
<li><b>Keys</b> are strings.</li>
<li><b>Values</b> hold either a sub-dictionary or a type that can be unambiguously serialized.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Features</h2>
<ul>
<li>Returns references to any stored value or sub-dictionary</li>
<li>Built-in support for <a href="https://eigen.tuxfamily.org/">Eigen</a></li>
<li>Print dictionaries to standard output as <a href="https://www.json.org/json-en.html">JSON</a></li>
<li>Serialize to and deserialize from <a href="https://msgpack.org/">MessagePack</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Non-features</h2>
<ul>
<li>Dictionaries are move-only (deep copies are possible, but now shallow copies)</li>
<li>Types need to deserialize unambiguously (<em>e.g.</em>, positive integers always deserialize to <code>unsigned</code>)</li>
<li>Array values are mostly limited to Eigen tensors (matrix, quaternion, vector)</li>
</ul>
<p >If any of these design decisions doesn't match what you are looking for, you can also check out a list of alternative libraries below.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Bazel</h2>
<p >Add to your <code>WORKSPACE</code> file the <code>http_archive</code> instruction from the <a href="https://github.com/stephane-caron/palimpsest/releases/tag/v3.0.0">release page</a>.</p>
<p >You can then define C++ targets that depend on <code>@palimpsest</code>:</p>
<div class="fragment"><div class="line">cc_binary(</div>
<div class="line">    name = <span class="stringliteral">&quot;my-target&quot;</span>,</div>
<div class="line">    srcs = [<span class="stringliteral">&quot;my-target.cpp&quot;</span>],</div>
<div class="line">    deps = [<span class="stringliteral">&quot;@palimpsest&quot;</span>],</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
CMake</h2>
<p >Make sure Eigen, fmt and spdlog are installed system-wise, for instance on Debian-based distributions:</p>
<div class="fragment"><div class="line">sudo apt install libeigen3-dev libfmt-dev libspdlog-dev</div>
</div><!-- fragment --><p >Then follow the standard CMake procedure:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">make -j4</div>
<div class="line">make install</div>
</div><!-- fragment --><p >Note that by default <a href="https://github.com/ludocode/mpack">MPack</a> will be built and installed from the <a href="https://github.com/stephane-caron/palimpsest/tree/main/third_party"><code>third_party</code></a> folder. Set <code>-DBUILD_MPACK=OFF</code> if you already have MPack 1.1 or later installed on your system.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
See also</h1>
<p >The <code>Dictionary</code> class in palimpsest derives from two classes of the <a href="https://github.com/jrl-umi3218/mc_rtc/">mc_rtc</a> robotics framework: <code>mc_rtc::Configuration</code> (similar API, based on RapidJSON) and <code>mc_rtc::DataStore</code> (general value types, but not serializable).</p>
<p >If some of the design decisions in palimpsest don't match your requirements, you can also check out the following alternatives:</p>
<ul>
<li><a href="https://github.com/nlohmann/json">JSON for Modern C++</a>: most user-friendly library of this list, serializes to MessagePack and other binary formats, but not designed for speed.</li>
<li><a href="https://github.com/mjbots/mjlib">mjlib</a>: includes a <code>telemetry</code> library if your use case is more specifically in robotics or embedded systems.</li>
<li><a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a>: good fit if you have a fixed schema (keys don't change at all) that you want to serialize to and from.</li>
<li><a href="https://github.com/Tencent/rapidjson/">RapidJSON</a>: low memory footprint, can serialize to MessagePack using other <a href="https://github.com/Tencent/rapidjson/wiki/Related-Projects">related projects</a>, but has linear lookup complexity as it stores dictionaries <a href="https://github.com/Tencent/rapidjson/issues/102">as lists of key-value pairs</a>.</li>
<li><a href="https://github.com/simdjson/simdjson/">simdjson</a>: uses SIMD instructions and microparallel algorithms to parse JSON (reportedly 4x faster than RapidJSON and 25x faster than JSON for Modern C++). </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
