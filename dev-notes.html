<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>palimpsest: Developer notes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">palimpsest<span id="projectnumber">&#160;v3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dev-notes.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Developer notes </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md13">Adding custom types</a></li>
<li class="level1"><a href="#autotoc_md14">Insertion order behavior</a></li>
<li class="level1"><a href="#autotoc_md15">Not a header-only library</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_dev_notes"></a></p>
<h1><a class="anchor" id="autotoc_md13"></a>
Adding custom types</h1>
<p >Adding a new custom type boils down to the following steps:</p>
<ul>
<li>Add implicit type conversions to <code><a class="el" href="Dictionary_8h.html">Dictionary.h</a></code></li>
<li>Add a read function specialization to <code>mpack/read.h</code></li>
<li>Add a write function specialization to <code>mpack/Writer.h</code></li>
<li>Add a write function specialization to <code>mpack/write.h</code></li>
<li>Add a write function specialization to <code>json/write.h</code></li>
</ul>
<p >Take a look at the existing types in these files and in unit tests for inspiration.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Insertion order behavior</h1>
<p >Palimpsest <code>Dictionary</code> objects do not preserve insertion order, unlike Python dictionaries which guarantee insertion order preservation since Python 3.7. This difference stems from our use of <code>std::unordered_map</code> as the underlying storage in the <code>Dictionary</code> class, which prioritizes lookup performance over order preservation.</p>
<p >While we could consider migrating to an alternative data structure to enforce insertion order conservation (note that <code>std::map</code> would not solve this as it maintains sorted order by key, not insertion order), such changes would require careful performance evaluation. In palimpsest, we explicitly prioritize performance over Python compatibility, so future structural changes such as that one should demonstrate that they don't compromise the library's performance on a benchmark of representative use cases.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
Not a header-only library</h1>
<p >The main blocker to distributing palimpsest as a header-only library is that we set a custom flush function <code>mpack_std_vector_writer_flush</code> to our internal MPack writers. The <a href="https://ludocode.github.io/mpack/group__writer.html">MPack Write API</a> requires a function pointer for that, and we define that function in the internal <code>palimpsest::mpack::Writer</code> class. Open a PR if you have ideas to go around that! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
